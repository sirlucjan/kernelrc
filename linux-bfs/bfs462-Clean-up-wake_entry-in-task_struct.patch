From c7f923fd89b8ef34058cdedd37bd34f1f46811a5 Mon Sep 17 00:00:00 2001
From: Alfred Chen <cchalpha@gmail.com>
Date: Fri, 25 Jul 2014 14:27:30 +0800
Subject: [PATCH] bfs: [Fix] Clean up wake_entry in task_struct

---
 include/linux/sched.h | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/include/linux/sched.h b/include/linux/sched.h
index 1c95831..5c445c9 100644
--- a/include/linux/sched.h
+++ b/include/linux/sched.h
@@ -1288,8 +1288,10 @@ struct task_struct {
 	unsigned int flags;	/* per process flags, defined below */
 	unsigned int ptrace;
 
-#if defined(CONFIG_SMP) || defined(CONFIG_SCHED_BFS)
+#if defined(CONFIG_SMP) && !defined(CONFIG_SCHED_BFS)
 	struct llist_node wake_entry;
+#endif
+#if defined(CONFIG_SMP) || defined(CONFIG_SCHED_BFS)
 	int on_cpu;
 #endif
 #ifdef CONFIG_SMP
-- 
2.1.1

